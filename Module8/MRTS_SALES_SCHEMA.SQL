DROP DATABASE IF EXISTS MRTSSALES;
CREATE DATABASE MRTSSALES;

DROP SCHEMA IF EXISTS PROJECT8;
CREATE SCHEMA PROJECT8;
USE MRTSSALES;

SET NAMES UTF8MB4;
SET character_set_client = UTF8MB4;

DROP TABLE IF EXISTS MRTSSALES_DATA;

CREATE TABLE MRTSSALES_DATA (
	NAICS_CODE			VARCHAR(25)		NULL,
    KIND_OF_BUSINESS	VARCHAR(255)	NULL,
    ADJUSTMENT_TYPE		VARCHAR(50)		NULL,
    VALUE				FLOAT			NULL,
    DATE				DATE			NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE OR REPLACE VIEW VW_MRTSALES_DATA
AS
SELECT
	NAICS_CODE,
    KIND_OF_BUSINESS,
    ADJUSTMENT_TYPE,
    VALUE,
    DATE,
    YEAR(DATE) AS YEAR,
    MONTH(DATE) AS MONTH
FROM
	MRTSSALES_DATA
WHERE
	LEFT(IFNULL(NAICS_CODE,''),3) = IFNULL(NAICS_CODE,'')
    AND ADJUSTMENT_TYPE = 'NOT ADJUSTED';	
    
CREATE OR REPLACE VIEW VW_MRTSALES_DATA_TOTAL
AS
SELECT
	NAICS_CODE,
    KIND_OF_BUSINESS,
    ADJUSTMENT_TYPE,
    VALUE,
    DATE,
    YEAR(DATE) AS YEAR,
    MONTH(DATE) AS MONTH
FROM
	MRTSSALES_DATA
WHERE
	NAICS_CODE = 'Total'
    AND ADJUSTMENT_TYPE = 'NOT ADJUSTED';	